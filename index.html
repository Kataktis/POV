<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kataktis POV Manager</title>
<style>
  html, body {margin:0; padding:0; height:100%; width:100%; display:flex; flex-direction:column; background:#0a0a0a; color:white;}
  header {flex-shrink:0; display:flex; align-items:center; justify-content:space-between; background:#1a1a1a; padding:10px 20px; border-bottom:3px solid #b10000;}
  header img {height:45px;}
  h1 {color:#b10000; font-size:1.6em; flex:1; text-align:center; letter-spacing:2px;}
  .player-selection {flex-shrink:0; display:flex; flex-wrap:wrap; justify-content:center; background:#141414; padding:10px; border-bottom:2px solid #b10000; gap:8px;}
  .player-selection label {display:flex; align-items:center; gap:6px; background:#1f1f1f; border-radius:8px; padding:6px 10px; cursor:pointer; transition:0.2s;}
  .player-selection label:hover {background:#b10000;}
  .player-selection img {width:18px; height:12px; border-radius:2px;}
  main {flex:1; display:flex; justify-content:center; align-items:stretch; overflow:hidden;}
  .pov-grid {display:grid; width:100%; height:100%; gap:10px; padding:10px; transition:all 0.3s ease;}
  .pov {position:relative; border:2px solid #b10000; border-radius:10px; overflow:hidden; background:black;}
  .pov iframe {width:100%; height:100%; border:none;}
  .info-bar {position:absolute; bottom:8px; left:8px; background:rgba(0,0,0,0.6); padding:4px 8px; border-radius:6px; display:flex; align-items:center; gap:6px; font-size:14px;}
  .info-bar img {width:20px; height:14px; border-radius:2px;}
  .focus-btn {position:absolute; top:8px; right:8px; background:#b10000; border:none; color:white; border-radius:5px; padding:4px 8px; cursor:pointer; transition:0.2s;}
  .focus-btn:hover {background:#ff0000;}
  .focused {position:fixed !important; top:0; left:0; width:100vw !important; height:100vh !important; z-index:100; background:black; border:3px solid #ff0000; box-shadow:0 0 25px #ff0000;}
  footer {flex-shrink:0; background:#1a1a1a; border-top:2px solid #b10000; text-align:center; padding:8px; font-size:0.9em; color:#bbb;}
</style>
</head>
<body>
<header>
  <img src="logo.png" alt="Logo Kataktis">
  <h1>Kataktis POV Manager</h1>
</header>

<div class="player-selection">
  <label><img src="hu.png"><input type="checkbox" data-player="erxk" checked> Erxk</label>
  <label><img src="it.png"><input type="checkbox" data-player="haxo" checked> Haxo</label>
  <label><img src="fr.png"><input type="checkbox" data-player="shin" checked> Shin</label>
  <label><img src="fr.png"><input type="checkbox" data-player="yayaz" checked> Yayaz</label>
  <label><img src="fr.png"><input type="checkbox" data-player="nerzox" checked> Nerzox</label>
</div>

<main>
  <div class="pov-grid" id="povGrid"></div>
</main>

<footer>Â© 2025 Kataktis eSport â€” Interface Staff POV</footer>

<script src="https://player.twitch.tv/js/embed/v1.js"></script>
<script>
const players = [
  {id:"erxk", name:"Erxk", flag:"hu.png", twitch:"erxk0"},
  {id:"haxo", name:"Haxo", flag:"it.png", twitch:"haxofnbr"},
  {id:"shin", name:"Shin", flag:"fr.png", twitch:"12shinn"},
  {id:"yayaz", name:"Yayaz", flag:"fr.png", twitch:"yayaz_fn"},
  {id:"nerzox", name:"Nerzox", flag:"fr.png", twitch:"nerzox35"}
];

const povGrid = document.getElementById("povGrid");
const checkboxes = document.querySelectorAll(".player-selection input");
let focusedIndex = -1;
const embeds = {}; // stocke les objets Twitch.Embed

function renderPOVs(){
  const activePlayers = players.filter(p => document.querySelector(`input[data-player="${p.id}"]`).checked);
  // Supprime ceux qui ne sont plus actifs
  document.querySelectorAll(".pov").forEach(pov => {
    if(!activePlayers.some(a=>a.id===pov.dataset.player)) pov.remove();
  });

  // Ajoute nouveaux POV sans reload
  activePlayers.forEach(p=>{
    if(!document.querySelector(`.pov[data-player="${p.id}"]`)){
      const div = document.createElement("div");
      div.classList.add("pov");
      div.dataset.player = p.id;
      div.innerHTML = `<div class="info-bar"><img src="${p.flag}" alt=""><span>${p.name}</span></div><div id="embed-${p.id}" style="width:100%;height:100%;"></div><button class="focus-btn" onclick="focusPOV('${p.id}')">ðŸŽ¯ Focus</button>`;
      povGrid.appendChild(div);

      // CrÃ©ation de l'embed Twitch
      embeds[p.id] = new Twitch.Embed(`embed-${p.id}`, {
        width:"100%",
        height:"100%",
        channel:p.twitch,
        parent:[location.hostname],
        autoplay:true,
        muted:true
      });
    }
  });

  adjustGrid(activePlayers.length);
}

function adjustGrid(count){
  const grid = povGrid;
  if(count<=1) grid.style.gridTemplateColumns="1fr";
  else if(count===2) grid.style.gridTemplateColumns="1fr 1fr";
  else if(count<=4) grid.style.gridTemplateColumns="repeat(2,1fr)";
  else grid.style.gridTemplateColumns="repeat(auto-fit,minmax(400px,1fr))";
}

function focusPOV(id){
  const povs = document.querySelectorAll(".pov");
  povs.forEach(p=>p.classList.remove("focused"));
  const pov = document.querySelector(`.pov[data-player="${id}"]`);
  if(!pov) return;
  pov.classList.add("focused");
  focusedIndex = Array.from(povs).indexOf(pov);
  muteAll();
  if(embeds[id]) embeds[id].setMuted(false);
}

function exitFocus(){
  document.querySelectorAll(".pov").forEach(p=>p.classList.remove("focused"));
  focusedIndex = -1;
  muteAll();
}

function muteAll(){
  Object.values(embeds).forEach(e=>{ if(e) e.setMuted(true); });
}

// Raccourcis clavier
document.addEventListener("keydown", e=>{
  const povs = Array.from(document.querySelectorAll(".pov"));
  if(focusedIndex===-1) return;
  if(e.key==="ArrowRight"){
    povs[focusedIndex].classList.remove("focused");
    focusedIndex=(focusedIndex+1)%povs.length;
    povs[focusedIndex].classList.add("focused");
    muteAll();
    const id=povs[focusedIndex].dataset.player;
    if(embeds[id]) embeds[id].setMuted(false);
  } else if(e.key==="ArrowLeft"){
    povs[focusedIndex].classList.remove("focused");
    focusedIndex=(focusedIndex-1+povs.length)%povs.length;
    povs[focusedIndex].classList.add("focused");
    muteAll();
    const id=povs[focusedIndex].dataset.player;
    if(embeds[id]) embeds[id].setMuted(false);
  } else if(e.key==="Escape") exitFocus();
});

checkboxes.forEach(cb=>cb.addEventListener("change", renderPOVs));

renderPOVs();
</script>
</body>
</html>
