<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kataktis POV Manager</title>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700&display=swap" rel="stylesheet" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Rajdhani', sans-serif;
    }

    body {
      background-color: #0d0d0d;
      color: white;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      overflow-x: hidden;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: #1a1a1a;
      padding: 10px 20px;
      border-bottom: 3px solid #ff0000;
      flex-wrap: wrap;
    }

    header img {
      height: 50px;
    }

    .title {
      font-size: 1.8em;
      color: #ff0000;
      letter-spacing: 2px;
      text-align: center;
      flex: 1;
    }

    .player-selection {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 10px;
    }

    .player-selection label {
      display: flex;
      align-items: center;
      background: #262626;
      padding: 5px 10px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
    }

    .player-selection label:hover {
      background: #ff0000;
    }

    .player-selection img {
      width: 20px;
      height: 14px;
      margin-right: 6px;
      border-radius: 2px;
    }

    main {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: stretch;
      padding: 10px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 10px;
      width: 100%;
      height: 100%;
    }

    .pov {
      position: relative;
      background: black;
      border: 2px solid #ff0000;
      border-radius: 10px;
      overflow: hidden;
      transition: all 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .pov iframe {
      width: 100%;
      height: 100%;
    }

    .pov-info {
      position: absolute;
      bottom: 8px;
      left: 8px;
      background: rgba(0, 0, 0, 0.6);
      padding: 4px 8px;
      border-radius: 5px;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
    }

    .pov-info img {
      width: 20px;
      height: 14px;
      border-radius: 2px;
    }

    .focus {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 10;
      background: black;
    }

    .focus iframe {
      width: 100%;
      height: 100%;
    }

    footer {
      background-color: #1a1a1a;
      border-top: 3px solid #ff0000;
      text-align: center;
      padding: 10px;
      font-size: 0.9em;
      color: #aaa;
      margin-top: auto;
    }

    button.focus-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(255, 0, 0, 0.7);
      border: none;
      color: white;
      padding: 5px 8px;
      border-radius: 5px;
      cursor: pointer;
      transition: 0.2s;
    }

    button.focus-btn:hover {
      background: rgba(255, 0, 0, 1);
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo Kataktis" />
    <div class="title">KATAKTIS POV MANAGER</div>
    <div class="player-selection" id="playerSelection"></div>
  </header>

  <main>
    <div class="grid" id="povGrid"></div>
  </main>

  <footer>© 2025 Kataktis Esport — Interface Staff Only</footer>

  <script src="https://embed.twitch.tv/embed/v1.js"></script>
  <script>
    const players = [
      { name: "Erxk", country: "hu", twitch: "erxk0" },
      { name: "Haxo", country: "it", twitch: "haxofnbr" },
      { name: "Shin", country: "fr", twitch: "12shinn" },
      { name: "Yayaz", country: "fr", twitch: "yayaz_fn" },
      { name: "Nerzox", country: "fr", twitch: "nerzox35" },
    ];

    const grid = document.getElementById("povGrid");
    const selection = document.getElementById("playerSelection");
    let activePlayers = new Set(players.map((p) => p.name));
    let focusedPlayer = null;

    function renderSelection() {
      selection.innerHTML = "";
      players.forEach((p) => {
        const label = document.createElement("label");
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = activePlayers.has(p.name);
        checkbox.addEventListener("change", () => {
          if (checkbox.checked) activePlayers.add(p.name);
          else activePlayers.delete(p.name);
          renderGrid();
        });

        const flag = document.createElement("img");
        flag.src = `${p.country}.png`;

        label.appendChild(flag);
        label.appendChild(document.createTextNode(p.name + " "));
        label.appendChild(checkbox);
        selection.appendChild(label);
      });
    }

    function renderGrid() {
      grid.innerHTML = "";
      const active = players.filter((p) => activePlayers.has(p.name));
      active.forEach((p) => {
        const pov = document.createElement("div");
        pov.className = "pov";
        pov.innerHTML = `
          <div id="twitch-${p.twitch}" class="twitch-container"></div>
          <div class="pov-info">
            <img src="${p.country}.png" alt="">
            <span>${p.name}</span>
          </div>
          <button class="focus-btn" onclick="focusPOV('${p.twitch}')">Focus</button>
        `;
        grid.appendChild(pov);

        // Lancer le stream Twitch
        setTimeout(() => {
          new Twitch.Embed(`twitch-${p.twitch}`, {
            width: "100%",
            height: "100%",
            channel: p.twitch,
            layout: "video",
            autoplay: false,
            muted: true,
          });
        }, 200);
      });
    }

    function focusPOV(twitch) {
      if (focusedPlayer) return;
      const playerData = players.find((p) => p.twitch === twitch);
      focusedPlayer = playerData;

      const focusDiv = document.createElement("div");
      focusDiv.className = "focus";
      focusDiv.innerHTML = `
        <div id="focus-twitch"></div>
        <div class="pov-info" style="bottom:20px;left:20px;font-size:20px;">
          <img src="${playerData.country}.png" alt="">
          <span>${playerData.name}</span>
        </div>
      `;
      document.body.appendChild(focusDiv);

      setTimeout(() => {
        new Twitch.Embed("focus-twitch", {
          width: "100%",
          height: "100%",
          channel: twitch,
          layout: "video",
          autoplay: true,
          muted: false,
        });
      }, 200);
    }

    function exitFocus() {
      const focusDiv = document.querySelector(".focus");
      if (focusDiv) focusDiv.remove();
      focusedPlayer = null;
    }

    document.addEventListener("keydown", (e) => {
      const visiblePlayers = players.filter((p) => activePlayers.has(p.name));
      if (focusedPlayer) {
        let index = visiblePlayers.findIndex((p) => p.name === focusedPlayer.name);
        if (e.key === "ArrowRight") {
          exitFocus();
          const next = visiblePlayers[(index + 1) % visiblePlayers.length];
          focusPOV(next.twitch);
        } else if (e.key === "ArrowLeft") {
          exitFocus();
          const prev = visiblePlayers[(index - 1 + visiblePlayers.length) % visiblePlayers.length];
          focusPOV(prev.twitch);
        } else if (e.key === "Escape") {
          exitFocus();
        }
      }
    });

    renderSelection();
    renderGrid();
  </script>
</body>
</html>
