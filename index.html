<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kataktis POV Manager</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin:0; padding:0; font-family:'Rajdhani', sans-serif;}
html, body {height:100%; width:100%; background:#0a0a0a; color:white; display:flex; flex-direction:column; overflow:hidden;}
header {flex-shrink:0; display:flex; align-items:center; justify-content:space-between; background:#1a1a1a; padding:10px 20px; border-bottom:3px solid #b10000;}
header img{height:45px;}
h1 {flex:1; text-align:center; color:#b10000; font-size:1.6em; text-transform:uppercase; letter-spacing:2px;}
.player-selection {flex-shrink:0; display:flex; flex-wrap:wrap; justify-content:center; background:#141414; padding:10px; border-bottom:2px solid #b10000; gap:8px;}
.player-selection label {display:flex; align-items:center; gap:6px; background:#1f1f1f; border-radius:8px; padding:6px 10px; cursor:pointer; transition:0.2s;}
.player-selection label:hover {background:#b10000;}
.player-selection img{width:18px; height:12px; border-radius:2px;}
main{flex:1; display:flex; justify-content:center; align-items:stretch; overflow:hidden;}
.pov-grid{display:grid; width:100%; height:100%; gap:10px; padding:10px; transition:all 0.3s ease;}
.pov{position:relative; border:2px solid #b10000; border-radius:10px; overflow:hidden; background:black;}
.info-bar{position:absolute; bottom:8px; left:8px; background:rgba(0,0,0,0.6); padding:4px 8px; border-radius:6px; display:flex; align-items:center; gap:6px; font-size:14px;}
.info-bar img{width:20px; height:14px; border-radius:2px;}
.focus-btn{position:absolute; top:8px; right:8px; background:#b10000; border:none; color:white; border-radius:5px; padding:4px 8px; cursor:pointer; transition:0.2s;}
.focus-btn:hover{background:#ff0000;}
.focused{position:fixed !important; top:0; left:0; width:100vw !important; height:100vh !important; z-index:100; background:black; border:3px solid #ff0000; box-shadow:0 0 25px #ff0000;}
footer{flex-shrink:0; background:#1a1a1a; border-top:2px solid #b10000; text-align:center; padding:8px; font-size:0.9em; color:#bbb;}
</style>
</head>
<body>

<header>
  <img src="logo.png" alt="Logo Kataktis">
  <h1>Kataktis POV Manager</h1>
</header>

<div class="player-selection">
  <label><img src="hu.png"><input type="checkbox" data-player="erxk" checked> Erxk</label>
  <label><img src="it.png"><input type="checkbox" data-player="haxo" checked> Haxo</label>
  <label><img src="fr.png"><input type="checkbox" data-player="shin" checked> Shin</label>
  <label><img src="fr.png"><input type="checkbox" data-player="yayaz" checked> Yayaz</label>
  <label><img src="fr.png"><input type="checkbox" data-player="nerzox" checked> Nerzox</label>
</div>

<main>
  <div class="pov-grid" id="povGrid"></div>
</main>

<footer>Â© 2025 Kataktis eSport â€” Interface Staff POV</footer>

<script src="https://player.twitch.tv/js/embed/v1.js"></script>
<script>
const players = [
  {id:"erxk", name:"Erxk", flag:"hu.png", twitch:"erxk0"},
  {id:"haxo", name:"Haxo", flag:"it.png", twitch:"haxofnbr"},
  {id:"shin", name:"Shin", flag:"fr.png", twitch:"12shinn"},
  {id:"yayaz", name:"Yayaz", flag:"fr.png", twitch:"yayaz_fn"},
  {id:"nerzox", name:"Nerzox", flag:"fr.png", twitch:"nerzox35"}
];

const povGrid = document.getElementById("povGrid");
const checkboxes = document.querySelectorAll(".player-selection input");
let focusedId = null;
const embeds = {}; // stocke les objets Twitch.Embed

function renderPOVs(){
  povGrid.innerHTML="";
  const activePlayers = players.filter(p=>document.querySelector(`input[data-player="${p.id}"]`).checked);
  activePlayers.forEach(p=>{
    const div=document.createElement("div");
    div.classList.add("pov");
    div.dataset.player=p.id;
    div.innerHTML=`
      <div class="embed-container" id="embed-${p.id}"></div>
      <div class="info-bar"><img src="${p.flag}" alt=""><span>${p.name}</span></div>
      <button class="focus-btn" onclick="focusPOV('${p.id}')">ðŸŽ¯ Focus</button>
    `;
    povGrid.appendChild(div);

    if(!embeds[p.id]){
      embeds[p.id]=new Twitch.Embed(`embed-${p.id}`, {
        width:"100%", height:"100%",
        channel: p.twitch,
        parent:[location.hostname],
        muted:true
      });
    }
  });
  adjustGrid(activePlayers.length);
}

function adjustGrid(count){
  if(count<=1)povGrid.style.gridTemplateColumns="1fr";
  else if(count===2)povGrid.style.gridTemplateColumns="1fr 1fr";
  else if(count<=4)povGrid.style.gridTemplateColumns="repeat(2,1fr)";
  else povGrid.style.gridTemplateColumns="repeat(auto-fit,minmax(400px,1fr))";
}

function focusPOV(id){
  document.querySelectorAll(".pov").forEach(p=>p.classList.remove("focused"));
  const pov=document.querySelector(`.pov[data-player="${id}"]`);
  if(!pov)return;
  pov.classList.add("focused");
  focusedId=id;

  // mute tous sauf le focus
  players.forEach(p=>{
    const playerEmbed=embeds[p.id];
    if(playerEmbed && playerEmbed.getPlayer){
      if(p.id===id) playerEmbed.getPlayer().setMuted(false);
      else playerEmbed.getPlayer().setMuted(true);
    }
  });
}

function exitFocus(){
  document.querySelectorAll(".pov").forEach(p=>p.classList.remove("focused"));
  focusedId=null;
  // mute tous
  players.forEach(p=>{
    const playerEmbed=embeds[p.id];
    if(playerEmbed && playerEmbed.getPlayer()) playerEmbed.getPlayer().setMuted(true);
  });
}

// raccourcis clavier
document.addEventListener("keydown", e=>{
  const activePovs=Array.from(document.querySelectorAll(".pov"));
  if(focusedId===null) return;
  let idx=activePovs.findIndex(p=>p.dataset.player===focusedId);
  if(e.key==="ArrowRight"){ idx=(idx+1)%activePovs.length; focusPOV(activePovs[idx].dataset.player);}
  else if(e.key==="ArrowLeft"){ idx=(idx-1+activePovs.length)%activePovs.length; focusPOV(activePovs[idx].dataset.player);}
  else if(e.key==="Escape") exitFocus();
});

checkboxes.forEach(cb=>cb.addEventListener("change", renderPOVs));

renderPOVs();
</script>

</body>
</html>
